///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
//Ce code permet de récupérer l'heure en temps reel et donc nous servira pour comparer avec notre JSON de l'api
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
//VARIABLES

#include <WiFi.h>
#include "time.h"

const char* ntpServer = "pool.ntp.org"; //SRV d'heure
const long gmtOffset_sec = 3600;        // GMT+1 (France)
const int daylightOffset_sec = 3600;    // Heure d'été

///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
//SETUP

void setup() {
  Serial.begin(9600);
  
  // Connexion WiFi (remplace avec tes identifiants)
  WiFi.begin("iPhone de John", "samuelpar");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
  }
  
  // Configuration NTP (une seule fois)
  configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
  delay(2000); // Attendre la synchronisation
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
//LOOP

void loop() {
  getHeureActuelle(); // Affiche: 14:51:23
  delay(1000);
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
//FONCTIONS

void getHeureActuelle() {
  struct tm timeinfo;
  if(!getLocalTime(&timeinfo)) {
    Serial.println("Pas d'heure disponible");
    return;
  }
  
  Serial.printf("%02d:%02d:%02d\n", 
                timeinfo.tm_hour, 
                timeinfo.tm_min, 
                timeinfo.tm_sec);
}